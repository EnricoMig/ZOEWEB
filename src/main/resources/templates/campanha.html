<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clínica Zoe - Campanhas</title>
    <link rel="stylesheet" th:href="@{/styles.css}">
    <link rel="stylesheet" th:href="@{/css/gerencia.css}">
    <link rel="stylesheet" th:href="@{/css/cards.css}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body>
    <!-- HEADER COM LOGO E NAVEGAÇÃO -->
    <header class="header">
        <div class="container header-content">
            <div class="logo">
                <img th:src="@{/images/logo-zoe.png}" alt="Logo Clínica Zoe">
                <div class="logo-text">
                    <h1>Grupo Zoe</h1>
                    <p>Medicina Ocupacional</p>
                </div>
            </div>

            <nav class="navbar">
                <a th:href="@{/gerencia}">DASHBOARD</a>
            </nav>
        </div>
    </header>

    <main class="gerente-layout">
        <!-- Sidebar lateral -->
      <aside class="sidebar">
            <h2>Administração</h2>
            <nav class="sidebar-nav">
                <a th:href="@{/admin/funcionario}">Funcionario</a>
                <a th:href="@{/admin/campanha}" class="active">Campanha</a>
                 <a th:href="@{/admin/medico}">Medico</a>
                <a href="#">Configurações</a>
            </nav>
        </aside>

        <!-- Conteúdo principal da dashboard -->
        <section class="dashboard">
            <div class="dashboard-header">
                <h2>Dashboard de Campanhas</h2>
                <a th:href="@{/admin/campanhas/cadastro}" class="btn-cadastrar">
                    <i class="fa-solid fa-plus"></i> Cadastrar Campanha
                </a>
            </div>

            <!-- Aqui será exibida a lista de campanhas futuramente -->
            <div class="dashboard-content" id="campanhas-ofertadas">
                <p>Carregando campanhas...</p>
            </div>

            <div class="dashboard-content" id="campanhas-aceitas">
                <p>Carregando campanhas aceitas...</p>
            </div>
        </section>

    </main>

    <!-- RODAPÉ -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <p>&copy; 2025 Clínica Zoe - Todos os direitos reservados</p>
            </div>
        </div>
    </footer>

    <!-- Script para carregar campanhas ofertadas -->
    <script>
   
async function carregarCampanhas() {
    try {
        const response = await fetch('/api/campanhaofertada');
        if (!response.ok) throw new Error('Erro ao buscar campanhas ofertadas');

        const campanhas = await response.json();
        const container = document.getElementById('campanhas-ofertadas');

        if (!campanhas || campanhas.length === 0) {
            container.innerHTML = `<p>Nenhuma campanha cadastrada.</p>`;
            return;
        }

        let cardsHTML = "";

        campanhas.forEach(c => {
            const periodo = `${formatarDataBR(c.dataInicio)} a ${formatarDataBR(c.dataFim)}`;

            cardsHTML += `
                <div class="card-campanha" style="
                    background: #fff;
                    border: 1px solid #ddd;
                    border-radius: 8px;
                    padding: 1rem;
                    margin-bottom: 1rem;
                    box-shadow: 0 2px 6px rgba(0,0,0,0.05);
                ">
                    <h3 style="margin:0 0 0.5rem 0; color:#6A1B9A;">
                        ${c.empresa} - ${c.filial}
                    </h3>
                    
                    <p><strong>Endereço:</strong> ${c.enderecoCompleto}</p>
                    
                    <p><strong>Período solicitado:</strong> ${periodo}</p>
                    <p><strong>Horário de Atendimento:</strong> ${c.horarioAtendimento}</p>
                    
                    <p><strong>Exames previstos:</strong> ${c.examesPrevistos}</p>
                    <div style="margin-top:0.8rem; display:flex; gap:0.5rem;">
                        <button class="btn-acao" style="background:#6A1B9A; color:white; padding:0.5rem 1rem; border:none; border-radius:6px; cursor:pointer;">
                            <i class="fa-solid fa-eye"></i> Visualizar
                        </button>
                        <button class="btn-acao" style="background:#AB47BC; color:white; padding:0.5rem 1rem; border:none; border-radius:6px; cursor:pointer;">
                            <i class="fa-solid fa-pen-to-square"></i> Editar
                        </button>
                        <button class="btn-acao" style="background:#d32f2f; color:white; padding:0.5rem 1rem; border:none; border-radius:6px; cursor:pointer;">
                            <i class="fa-solid fa-trash"></i> Excluir
                        </button>
                    </div>
                </div>
            `;
        });

        container.innerHTML = cardsHTML;

    } catch (error) {
        console.error(error);
        document.getElementById('campanhas-ofertadas').innerHTML =
            `<p>Erro ao carregar campanhas ofertadas.</p>`;
    }
}

async function carregarCampanhasAceitas() {
    try {
        const response = await fetch('/api/campanhasaceitas'); // atenção ao endpoint plural
        if (!response.ok) throw new Error('Erro ao buscar campanhas aceitas');

        const campanhas = await response.json();
        const container = document.getElementById('campanhas-aceitas');

        if (!campanhas || campanhas.length === 0) {
            container.innerHTML = `<p>Nenhuma campanha aceita.</p>`;
            return;
        }

        let cardsHTML = "";

        campanhas.forEach(c => {
            const periodo = `${formatarDataBR(c.dataInicio)} a ${formatarDataBR(c.dataFim)}`;

            cardsHTML += `
                <div class="card-campanha" style="
                    background: #fff;
                    border: 1px solid #ddd;
                    border-radius: 8px;
                    padding: 1rem;
                    margin-bottom: 1rem;
                    box-shadow: 0 2px 6px rgba(0,0,0,0.05);
                ">
                    <h3 style="margin:0 0 0.5rem 0; color:#6A1B9A;">
                        ${c.empresa} - ${c.filial}
                    </h3>
                    <p><strong>Endereço:</strong> ${c.enderecoCompleto}</p>
                    <p><strong>Período:</strong> ${periodo}</p>
                    <p><strong>Horário:</strong> ${c.horarioAtendimento}</p>
                    
                    <hr style="margin:0.8rem 0; border:none; border-top:1px dashed #ccc;">
                    
                    <p><strong>${c.nomeCompleto}</strong></p>
                    <p>CRM: ${c.crm}</p>
                    <p>CPF: ${c.cpf}</p>
                </div>
            `;
        });

        container.innerHTML = cardsHTML;

    } catch (error) {
        console.error(error);
        document.getElementById('campanhas-aceitas').innerHTML =
            `<p>Erro ao carregar campanhas aceitas.</p>`;
    }
}

// ✅ Reutiliza mesma função de formatação
function formatarDataBR(dataISO) {
    if (!dataISO) return "-";
    const [ano, mes, dia] = dataISO.split("-");
    return `${dia}/${mes}/${ano}`;
}

// ✅ Carrega automaticamente
document.addEventListener('DOMContentLoaded', () => {
    carregarCampanhas();        
    carregarCampanhasAceitas();
});
</script>

    </script>
</body>
</html>
